<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>플레이콘</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/audio_ssok.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
    <script src="./js/common.js"></script>
    <script src="https://kit.fontawesome.com/a9123cc962.js" crossorigin="anonymous"></script>
</head>
<body>
    <div id="wrap" class="sub_m">
        <header id="header" class="sub_header">
            <a href="" class="btn_back"><span class="blind">뒤로가기</span></a>
            <h1 class="tit">오디오쏙</h1>
        </header>
        <div id="container" class="sub_m ty_audio_ssok has_player">
            <div class="audio_ssok">
                <div class="audio_ssok_top">
                    <div class="audio_ssok_top_inner">
                        <div class="img_box">
                            <div class="sc_thumb ty2">
                                <div class="sc_thumb_img">
                                    <img src="https://kids.dongascience.com/upload/issue/2022/03/16481722579798.png" alt="">
                                </div>
                            </div>
                        </div>
                        <div class="txt_box">
                            <h1 class="logo">
                                <img src="/images/common/logo_kids_sci.svg" alt="">
                            </h1>
                            <h2 class="tit">
                                2022년 <br>
                                04월 01일 07호
                                <span class="vol">vol 423</span>
                            </h2>
                            <div class="btn_box">
                                <span class="total_playtime">
                                    <i><img src="./images/ico/ico_clock.svg" alt=""></i>
                                    총 00분 00초
                                </span>
                                <button type="button" class="btn_playall" onclick="playAudio(0)">
                                    전체재생
                                    <i><img src="./images/ico/ico_play_w.svg" alt=""></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg_box" style="background-image:url('https://kids.dongascience.com/upload/issue/2022/03/16481722579798.png');"></div>


                </div>
                <div class="audio_ssok_cont inner">
                    <ul class="audio_ssok_list">
                        <li class="audio_item">
                            <div class="audio_thumb" onclick="playAudio(0);">
                                <div class="sc_thumb">
                                    <div class="sc_thumb_img">
                                        <img src="https://picsum.photos/1600/900" alt="">
                                        <div class="equalizer_layer">
                                            <div class="equalizer_set">
                                                <span class="equalizer_bar bar1"></span>
                                                <span class="equalizer_bar bar2"></span>
                                                <span class="equalizer_bar bar3"></span>
                                                <span class="equalizer_bar bar4"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="ico_audio ty2">
                                        <img src="./images/ico/ico_audio.svg" alt="">
                                    </span>

                                </div>
                            </div>
                            <div class="txt_box"  onclick="playAudio(0);">
                                <h2 class="tit ellipsis2"><span class="sc_ico new">N</span> [테스트 테스트 테스트] 테스트 테스트 테스트 테스트 테스트 테스트 테스트 테스트테 스트 테스 트테스트 테스트 트테스트 테스트 트테스트 테스트 트테스트 테스트</h2>
                                <div class="audioDu"></div>
                            </div>
                        </li>
                        <li class="audio_item">
                            <div class="audio_thumb" onclick="playAudio(1);">
                                <div class="sc_thumb">
                                    <div class="sc_thumb_img">
                                        <img src="https://picsum.photos/1600/900" alt="">
                                        <div class="equalizer_layer">
                                            <div class="equalizer_set">
                                                <span class="equalizer_bar bar1"></span>
                                                <span class="equalizer_bar bar2"></span>
                                                <span class="equalizer_bar bar3"></span>
                                                <span class="equalizer_bar bar4"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="ico_audio ty2">
                                        <img src="./images/ico/ico_audio.svg" alt="">
                                    </span>

                                </div>
                            </div>
                            <div class="txt_box" onclick="playAudio(1);">
                                <h2 class="tit ellipsis2"><span class="sc_ico new">N</span> [테스트2 테스트2 테스트2] 테스트2 테스트2 테스트2 테스트2 테스트2 테스트2</h2>
                                <div class="audioDu"></div>
                            </div>
                        </li>
                        <li class="audio_item">
                            <div class="audio_thumb" onclick="playAudio(2);">
                                <div class="sc_thumb">
                                    <div class="sc_thumb_img">
                                        <img src="https://picsum.photos/1600/900" alt="">
                                        <div class="equalizer_layer">
                                            <div class="equalizer_set">
                                                <span class="equalizer_bar bar1"></span>
                                                <span class="equalizer_bar bar2"></span>
                                                <span class="equalizer_bar bar3"></span>
                                                <span class="equalizer_bar bar4"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="ico_audio ty2">
                                        <img src="./images/ico/ico_audio.svg" alt="">
                                    </span>

                                </div>
                            </div>
                            <div class="txt_box" onclick="playAudio(2);">
                                <h2 class="tit ellipsis2"><span class="sc_ico new">N</span> [테스트3 테스트3 테스트3] 테스트3 테스트3 테스트3 테스트3 테스트3 테스트3</h2>
                                <div class="audioDu"></div>
                            </div>
                        </li>
                        <li class="audio_item">
                            <div class="audio_thumb" onclick="playAudio(3);">
                                <div class="sc_thumb">
                                    <div class="sc_thumb_img">
                                        <img src="https://picsum.photos/1600/900" alt="">
                                        <div class="equalizer_layer">
                                            <div class="equalizer_set">
                                                <span class="equalizer_bar bar1"></span>
                                                <span class="equalizer_bar bar2"></span>
                                                <span class="equalizer_bar bar3"></span>
                                                <span class="equalizer_bar bar4"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="ico_audio ty2">
                                        <img src="./images/ico/ico_audio.svg" alt="">
                                    </span>

                                </div>
                            </div>
                            <div class="txt_box" onclick="playAudio(3);">
                                <h2 class="tit ellipsis2"><span class="sc_ico new">N</span> [테스트4 테스트4 테스트4] 테스트4 테스트4 테스트4 테스트4 테스트4 테스트4</h2>
                                <div class="audioDu"></div>
                            </div>
                        </li>
                    </ul>
                </div>

            </div>
            <!--
                audio_player 클래스
                노출, 비노출 : on
                축소 : minimal
                확장 : maximal
            -->
            <div class="audio_player maximal">
                <div class="audio-player">
                    <!--
                    <div class="timeline">
                        <div class="progress"></div>
                    </div>
                    -->


                    <div class="full_tit">
                        <button class="btn_toggle_size btn_minimal" onclick="player_min();"><span class="blind">축소</span></button>
                        <h2 id="audio_tit" class="full_tit_txt ellipsis4">재생중인 오디오가 없습니다.</h2>
                    </div>
                    <div class="slider_wrap">
                        <div class="slider">

                        </div>
                    </div>

                    <div class="controls">
                        <div class="marquee_tit">
                            <marquee id="marquee" >
                                <div class="marquee_inner">
                                    재생중인 오디오가 없습니다.
                                </div>
                            </marquee>
                        </div >

                        <div class="time">
                            <div class="current">0:00</div>
                            <div class="length">0:00</div>
                        </div>


                        <div class="control_box">
                            <button onclick="rewindAudio()" class="control_box_btns btn_rewind"><span class="blind">rewind</span><span class="sec">-15</span><span class="blind">sec</span></button>
                            <div class="player_btn play"></div>
                            <button onclick="forwardAudio()" class="control_box_btns btn_forward"><span class="blind">forward</span><span class="sec">+15</span><span class="blind">sec</span></button>
                        </div>
                        <div class="controls_bot">
                            <div class="controls_bot_left">
                                <div class="speed_ctrl">
                                    <strong class="blind">재생속도</strong>
                                    <select name="" id="" onchange="speed(this)">
                                        <option value="0.25">X 0.25</option>
                                        <option value="0.5">X 0.5</option>
                                        <option value="0.75">X 0.75</option>
                                        <option value="1" selected>X 1.00</option>
                                        <option value="1.25">X 1.25</option>
                                        <option value="1.5">X 1.5</option>
                                        <option value="1.75">X 1.75</option>
                                        <option value="2">X 2.00</option>
                                    </select>
                                </div>
                                <div class="volume-container">
                                    <div class="volume-slider">
                                        <div class="volume-percentage"></div>
                                    </div>
                                    <div class="volume-button">
                                        <i class="volume fa-solid fa-volume-high"></i>
                                    </div>
                                </div>
                            </div>
                            <a href="" class="btn_article">기사 보러가기</a>
                        </div>
                        <button class="btn_toggle_size btn_maximal" onclick="player_max();">
                            <span class="blind">확장</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script>
        var audios = [
            {
                "url":"./audio/audio1.mp3",
                "title":"[테스트 테스트 테스트] 테스트 테스트 테스트 테스트 테스트 테스트 테스트 테스트테 스트 테스 트테스트 테스트 트테스트 테스트 트테스트 테스트 트테스트 테스트",
            },
            {
                "url":"./audio/audio2.mp3",
                "title":"[테스트2 테스트2 테스트2] 테스트2 테스트2 테스트2 테스트2 테스트2 테스트2",
            },
            {
                "url":"./audio/audio3.mp3",
                "title":"[테스트3 테스트3 테스트3] 테스트3 테스트3 테스트3 테스트3 테스트3 테스트3",
            },
            {
                "url":"./audio/audio5.mp3",
                "title":"[테스트4 테스트4 테스트4] 테스트4 테스트4 테스트4 테스트4 테스트4 테스트4",
            }
        ];

        const audioPlayer = document.querySelector(".audio-player");
        const audio = new Audio(
            audios[0].url
        );

        function getDuration(src, cb) {
            var audioDu = new Audio();
            $(audioDu).on("loadedmetadata", function(){
                cb(audioDu.duration);
            });
            audioDu.src = src;
        }

            for(let i = 0; i <audios.length; i++ ){
                //console.log(audios[i].url);
                let time;
                let min;
                let sec;
                getDuration(audios[i].url, function(length) {

                    min = Math.floor(length/60);
                    sec = Math.floor(length%60);
                    if(min>0){
                        time = min +'분 ' + sec+'초';
                    }else{
                        time = sec+'초';
                    }
                    console.log(time);
                    document.querySelectorAll('.audioDu')[i].textContent = "총 " + time;

                });
            }



        //var networkState = audio.readystate;
        //console.log('networkState', networkState);

        var audioTime;
        audio.addEventListener("loadeddata",() => {
            audioPlayer.querySelector(".time .length").textContent = getTimeCodeFromNum(
                audio.duration
            );
            audioTime =  audio.duration;
            console.log(audioTime);

            audio.volume = .75;

        }, false);


        $('.slider').slider({
            value: 0,
            step: 0.1,
            min: 0,
            range:"min",
            max: audioTime,
            slide: function( event, ui ) {
                //console.log(ui.value);
                console.log(ui.value);
                const timelineWidth = ui.value;
                const timeToSeek = ui.value / 100 * audio.duration;
                audio.currentTime = timeToSeek;

            },
        });

        //click volume slider to change volume
        const volumeSlider = audioPlayer.querySelector(".controls .volume-slider");
        const volume_txt = document.querySelector(".volume_txt");
        volumeSlider.addEventListener('click', e => {
            const sliderWidth = window.getComputedStyle(volumeSlider).width;
            const newVolume = e.offsetX / parseInt(sliderWidth);
            audio.volume = newVolume;

            //volume_txt.innerHTML = newVolume;

            audioPlayer.querySelector(".controls .volume-percentage").style.width = newVolume * 100 + '%';
        }, false)

        //check audio percentage and update time accordingly

        const GV = {
            isPause: false,
            timer: null
        }
        const setTimer = function(){
            GV.isPause = false;
            GV.timer = setInterval(function(){
                /*
                const progressBar = audioPlayer.querySelector(".progress");
                progressBar.style.width = audio.currentTime / audio.duration * 100 + "%";
                */
                audioPlayer.querySelector(".time .current").textContent = getTimeCodeFromNum(
                    audio.currentTime
                );

                //console.log(audio.currentTime);
                $('.slider').slider('value',audio.currentTime / audio.duration * 100);

            }, 10);
        };
        const stopTimer = function(){
            clearInterval(GV.timer);
            GV.isPause = true;
        };



        //toggle between playing and pausing on button click
        const playBtn = audioPlayer.querySelector(".controls .player_btn");
        playBtn.addEventListener("click",() => {
            if (audio.paused) {
                playBtn.classList.remove("play");
                playBtn.classList.add("pause");
                play();

            } else {
                playBtn.classList.remove("pause");
                playBtn.classList.add("play");
                pause();

            }
        },false);

        audioPlayer.querySelector(".volume-button").addEventListener("click", () => {
            const volumeEl = audioPlayer.querySelector(".volume-container .volume");
            audio.muted = !audio.muted;
            if (audio.muted) {
                volumeEl.classList.remove("fa-volume-high");
                volumeEl.classList.add("fa-volume-xmark");
            } else {
                volumeEl.classList.remove("fa-volume-xmark");
                volumeEl.classList.add("fa-volume-high");
            }
        });

        //turn 128 seconds into 2:08
        function getTimeCodeFromNum(num) {
        let seconds = parseInt(num);
        let minutes = parseInt(seconds / 60);
        seconds -= minutes * 60;
        const hours = parseInt(minutes / 60);
        minutes -= hours * 60;

        if (hours === 0) return `${minutes}:${String(seconds % 60).padStart(2, 0)}`;
        return `${String(hours).padStart(2, 0)}:${minutes}:${String(
            seconds % 60
        ).padStart(2, 0)}`;
        }



        var currentVal = 0;
        var currentFile = "";
        var audioName = audios[currentVal].title;
        var play_speed = 1;
        function playAudio(val) {
            var url = audios[val].url;
            var name = audios[val].title;
            //console.log(name);


            if (url !== currentFile) {
                audio.src = url;
                audioName = name;
                currentFile = url;
                currentVal = val;

                //$('.name').text(audioName);

            }
            if (audio.paused) {
                //oAudio.play();
                audio.playbackRate = play_speed;
                play();

            }else{

                pause();
            }
        }


        function play(){
                clearAutoplay();
                audio.play();
                playBtn.classList.add("pause");
                playBtn.classList.remove("play");
                $('.audio_item').removeClass('on');
                //$('.audio_item .btn').removeClass('on');
                $('.audio_item').eq(currentVal).addClass('on').find('.btn').addClass('on');
                $('.marquee_inner').html( audioName);
                $('#audio_tit').text(audioName);
                console.log(audioName);
                setTimer();
        }

        function pause(){
            audio.pause();
            playBtn.classList.remove("pause");
            playBtn.classList.add("play");
            $('.audio_item').removeClass('on');
            stopTimer();
        }





        // 15초 뒤로
        function rewindAudio() {
            console.log(audio);
            if (window.HTMLAudioElement) {
                try {
                    audio.currentTime -= 15.0;
                    //console.log(audio.currentTime)
                    $('.slider').slider('value',audio.currentTime / audio.duration * 100);

                }
                catch (e) {
                    if(window.console && console.error("Error:" + e));
                }
            }
        }

        // 15초 앞으로
        function forwardAudio() {
            console.log(audio);
            if (window.HTMLAudioElement) {
                try {
                    audio.currentTime += 15.0;
                    //console.log(audio.currentTime)
                    $('.slider').slider('value',audio.currentTime / audio.duration * 100);
                }
                catch (e) {
                    if(window.console && console.error("Error:" + e));
                }
            }
        }


        // 정지
        function AudioStop()
        {
            //audio.Stop();
        }


        function speed(e){
            var $val = $(e).val();
            //console.log($val);
            play_speed = $val
            audio.playbackRate = play_speed;
        }


        var $autoplay;
        function autoplay(){
            $autoplay = setTimeout(function(){
                playAudio(currentVal);
            },1000);
        }
        function clearAutoplay(){
            clearTimeout($autoplay);
        }

        function player_max(){
            document.querySelector('.audio_player').classList.add('maximal');
            document.querySelector('.audio_player').classList.remove('minimal');
        }
        function player_min(){
            document.querySelector('.audio_player').classList.add('minimal');
            document.querySelector('.audio_player').classList.remove('maximal');
        }




        audio.onended = function(){
            //console.log('123123');
            if(currentVal < $('.audio_item').length -1){

                //$('.audio_item').eq(currentVal).
                //console.log(currentVal);
                currentVal += 1;
                playBtn.classList.remove("pause");
                playBtn.classList.add("play");
                autoplay();
                //playAudio(currentVal);

            }else{
                playBtn.classList.remove("pause");
                playBtn.classList.add("play");
            }
            $('.audio_item').removeClass('on');
        }
    </script>
</body>
</html>